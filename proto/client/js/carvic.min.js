////////////////////////////////////////////////////////////////////
var Carvic={},today=new Date;Carvic.Model={},Carvic.Model.NodeSearchResult=ko.observableArray([]),Carvic.Model.CurrentNode=ko.observable({ID:44,Name:"Name 44",Status:ko.observable("Unknown"),Cluster:"Cluster 0",LON:46.91092,LAT:12,Enabled:ko.observable(!0)}),Carvic.Model.ShowCurrentNode=ko.observable(!1),Carvic.Model.NodeSearchLON=ko.observable(0),Carvic.Model.NodeSearchLAT=ko.observable(0),Carvic.Model.NodeSearchName=ko.observable(""),Carvic.Model.NodeSearchId=ko.observable(""),Carvic.Model.UserList=ko.observableArray([]),Carvic.Model.ShowCurrentUserLogins=ko.observable(!1),Carvic.Model.CurrentUser=ko.observable({ID:99,Username:"username_99",FullName:"User 99",Status:ko.observable("Active"),Type:"Normal",LastLogin:new Date,LastBadLogin:new Date,BadLoginCount:0,LoginHistory:[],History:[]}),Carvic.Model.error=ko.observable(""),Carvic.Model.has_errors=ko.observable(!1),Carvic.Utils={},Carvic.Utils.FormatDate=function(e){var t=e.getDate(),n=e.getMonth()+1,r=e.getFullYear();return t+"."+n+"."+r},Carvic.Utils.FormatDateTime=function(e){var t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();return Carvic.Utils.FormatDate(e)+" "+t+":"+n+":"+r},Carvic.Utils.FormatMoney=function(e){var t=2,n=".",r=",",i=e,t=isNaN(t=Math.abs(t))?2:t,r=r==undefined?".":r,n=n==undefined?",":n,s=i<0?"-":"",o=parseInt(i=Math.abs(+i||0).toFixed(t))+"",u=(u=o.length)>3?u%3:0;return s+(u?o.substr(0,u)+n:"")+o.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+n)+(t?r+Math.abs(i-o).toFixed(t).slice(2):"")},Carvic.Utils.Post=function(e,t){$.ajax({type:"POST",url:"/",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",success:function(e){if(e.error==null){var n=JSON.parse(e);t(n)}else Carvic.Model.error(e.error.message+"<br/>"+e.location),Carvic.Model.has_errors(!0)},dataType:"text",processData:!1})},Carvic.Utils.GetUrlParam=function(e){var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);return r!=null?r[1]:null},Carvic.Model.LoadUsers=function(){Carvic.Model.UserList().length=0;for(var e=0;e<10;e++)Carvic.Model.UserList.push({ID:e,Username:"username_"+e,FullName:"User "+e,Status:ko.observable(e%4==0?"Inactive":e%7==0?"Locked":"Active"),Type:e%6==0?"Admin":"Normal",LastLogin:new Date,LastBadLogin:new Date,BadLoginCount:e+13%17==0?2:0,LoginHistory:[{When:new Date,What:"Logged in from 138.232.1.34"},{When:new Date,What:"Logged in from 138.232.1.34"},{When:new Date,What:"Logged in from 138.232.1.34"}],History:[{When:new Date,What:"Activated by admin1",Status:"info"},{When:new Date,What:"Edited",Status:"info"},{When:new Date,What:"Locked due to invalid password limit",Status:"warning"},{When:new Date,What:"Activated by admin2",Status:"info"}]})},Carvic.Model.ShowUserDetails=function(e){window.location="user.html?id="+e.ID},Carvic.Model.LoadUser=function(e){var t=e;Carvic.Model.CurrentUser({ID:t,Username:ko.observable("username_"+t),FullName:ko.observable("User "+t),Status:ko.observable(t%4==0?"Inactive":t%7==0?"Locked":"Active"),Type:t%6==0?"Admin":"Normal",LastLogin:new Date,LastBadLogin:new Date,BadLoginCount:t+13%17==0?2:0,LoginHistory:[{When:new Date,What:"Logged in from 138.232.1.34"},{When:new Date,What:"Logged in from 138.232.1.34"},{When:new Date,What:"Logged in from 138.232.1.34"}],History:[{When:new Date,What:"Activated by admin1",Status:"info"},{When:new Date,What:"Edited",Status:"info"},{When:new Date,What:"Locked due to invalid password limit",Status:"warning"},{When:new Date,What:"Activated by admin2",Status:"info"}]})},Carvic.Model.CloseUserDetails=function(){window.location="users.html"},Carvic.Model.DisableUser=function(){Carvic.Model.CurrentUser().Status("Inactive")},Carvic.Model.EnableUser=function(){Carvic.Model.CurrentUser().Status("Active")},Carvic.Model.CurrentUserShowLogins=function(){Carvic.Model.ShowCurrentUserLogins(!0)},Carvic.Model.CurrentUserShowChanges=function(){Carvic.Model.ShowCurrentUserLogins(!1)},Carvic.Model.SearchNodes=function(){Carvic.Model.NodeSearchResult().length=0;for(var e=0;e<10;e++)Carvic.Model.NodeSearchResult.push(ko.observable({ID:e,Name:"Name "+e,Status:ko.observable(e%4==0?"Unknown":"Active"),Cluster:"Cluster "+e%2,LON:45+.04343*e,LAT:12+.04343*(e%4),Enabled:ko.observable(!0)}))},Carvic.Model.ShowNodeDetails=function(e){Carvic.Model.CurrentNode(e),Carvic.Model.ShowCurrentNode(!0)},Carvic.Model.CloseNodeDetails=function(){Carvic.Model.ShowCurrentNode(!1)},Carvic.Model.DisableNode=function(){Carvic.Model.ShowCurrentNode().Enabled(!1)},Carvic.Model.EnableNode=function(){Carvic.Model.ShowCurrentNode().Enabled(!0)},Carvic.Model.InsertNew=function(){var e={action:"insert",for_insert:{}},t=Carvic.Model.pay_date();e.for_insert.y=parseInt(t.substring(0,4)),e.for_insert.m=parseInt(t.substring(5,7)),e.for_insert.d=parseInt(t.substring(8,10)),e.for_insert.u=Carvic.Model.pay_user(),e.for_insert.a=parseFloat(Carvic.Model.pay_amt()),alert(JSON.stringify(e)),Carvic.Utils.Post(e,function(e){alert("Done"),Carvic.Model.Refresh()})},Carvic.Model.CloseMonth=function(){Carvic.Utils.Post({action:"retrieve"},function(e){alert("Done"),Carvic.Model.Refresh()})},Carvic.Model.SendMails=function(){},Carvic.Model.Refresh=function(){},Carvic.Init=function(){Carvic.Model.Refresh(),Carvic.Model.SearchNodes(),Carvic.Model.LoadUsers()},Carvic.InitUserList=function(){Carvic.Model.LoadUsers()},Carvic.InitSingleUser=function(){var e=Carvic.Utils.GetUrlParam("id");e?Carvic.Model.LoadUser(e):Carvic.Model.LoadUser(5)};